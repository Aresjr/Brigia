<div class="mt-4">

  <app-top-bar (search)="onSearch($event)" title="Atendimentos"></app-top-bar>

  @if (isLoading) {
    <app-loading-spinner></app-loading-spinner>
  } @else if (itensExibicao.length === 0) {
    <div class="text-center py-8 w-full bg-base-100 rounded-lg shadow-md">
      <p>Nenhum registro encontrado.</p>
    </div>
  } @else {
    <div class="min-h-[36rem]">
      <div class="titulo-listagem grid-cols-[10rem_1fr_7rem_6rem_6rem_12rem_32px]">
        <div (click)="ordenar('status')" class="cabecalho-listagem rounded-tl-lg">
          @if (getSortIcon('status')) {
            <lucide-icon [name]="getSortIcon('status')" class="icone-ordenacao"/>
          }
          Status
        </div>
        <div (click)="ordenar('paciente')" class="cabecalho-listagem">
          @if (getSortIcon('paciente')) {
            <lucide-icon [name]="getSortIcon('paciente')" class="icone-ordenacao"/>
          }
          Paciente
        </div>
        <div (click)="ordenar('data')" class="cabecalho-listagem">
          @if (getSortIcon('data')) {
            <lucide-icon [name]="getSortIcon('data')" class="icone-ordenacao"/>
          }
          Data
        </div>
        <div (click)="ordenar('horaInicio')" class="cabecalho-listagem">
          @if (getSortIcon('horaInicio')) {
            <lucide-icon [name]="getSortIcon('horaInicio')" class="icone-ordenacao"/>
          }
          In√≠cio
        </div>
        <div (click)="ordenar('horaFim')" class="cabecalho-listagem">
          @if (getSortIcon('horaFim')) {
            <lucide-icon [name]="getSortIcon('horaFim')" class="icone-ordenacao"/>
          }
          Fim
        </div>
        <div (click)="ordenar('especialidade')" class="cabecalho-listagem">
          @if (getSortIcon('especialidade')) {
            <lucide-icon [name]="getSortIcon('especialidade')" class="icone-ordenacao"/>
          }
          Especialidade
        </div>
        <div class="cabecalho-listagem p-0 rounded-tr-lg"></div>
      </div>

      <div class="itens-listagem">
        @for (atendimento of getItensPaginados(); track atendimento.id) {
          <div class="item-listagem grid-cols-[10rem_1fr_7rem_6rem_6rem_12rem_32px]"
            [class.bg-error]="atendimento.excluido"
            [class.bg-opacity-50]="atendimento.excluido"
            (click)="selecionar(atendimento);">
            <div class="celula-listagem flex items-center px-4">
              <div class="badge text-base-100" [ngClass]="'bg-['+CorAtendimento[atendimento.status]+']'">
                {{ StatusAtendimentoDescricao[atendimento.status] }}
              </div>
            </div>
            <div class="celula-listagem">{{atendimento.paciente.nome }}</div>
            <div class="celula-listagem">{{atendimento.data | date:'dd/MM/yyyy' }}</div>
            <div class="celula-listagem">{{atendimento.horaInicio }}</div>
            <div class="celula-listagem">{{atendimento.horaFim }}</div>
            <div class="celula-listagem">{{atendimento.especialidade.nome }}</div>
            <div class="p-0 text-right">
              <div class="dropdown dropdown-end" (click)="$event.stopPropagation()">
                <label tabindex="0" class="btn btn-ghost btn-sm m-0 p-0">
                  <lucide-icon name="ellipsis-vertical" class="h-5" />
                </label>
                <ul tabindex="0" class="dropdown-content menu p-1 shadow-lg bg-base-100 rounded-lg w-40 z-[1] font-semibold">
                  @if (!atendimento.excluido) {
                    <li>
                      <a (click)="editar(atendimento)"
                        class="text-sm text-neutral hover:bg-base-200">
                        Editar
                      </a>
                    </li>
                  }
                  @if (!atendimento.excluido) {
                    <li>
                      <a (click)="perguntaExcluir($event, atendimento)"
                        class="text-error hover:bg-error/50">
                        Excluir
                      </a>
                    </li>
                  }
                  @if (atendimento.excluido) {
                    <li>
                      <a (click)="restaurarItem($event, atendimento)"
                        class="text-success hover:bg-success/20">
                        Restaurar
                      </a>
                    </li>
                  }
                </ul>
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <app-pagination [items]="itensExibicao" [totalPaginas]="totalPaginas" (pageChange)="pageChange($event)"></app-pagination>
  }

  @if (mostrarFormularioNovo) {
    <app-atendimento-form
      [atendimento]="itemEdicao"
      [agendamentoId]="agendamentoId"
      (save)="onSalvarNovoAtendimento($event)"
      (cancel)="cancelarNovo()"
    ></app-atendimento-form>
  }

  @if (exibeConfirmExclusao) {
    <app-confirm-dialog
      message="Deseja realmente excluir este atendimento?"
      (confirm)="excluir()"
      (cancel)="fecharConfirmExclusao()"
    ></app-confirm-dialog>
  }

  <app-fab (clicked)="novoAgendamento()"></app-fab>

</div>
