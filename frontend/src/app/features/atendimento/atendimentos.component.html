<div class="mt-4">

  <app-top-bar (search)="onSearch($event)" title="Atendimentos"></app-top-bar>

    @if (isLoading) {
        <div class="flex justify-center items-center h-32">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary"></div>
        </div>
    } @else if (itensExibicao.length === 0) {
        <div class="text-center py-8 w-full bg-base-100 rounded-md shadow-md">
            <p>Nenhum registro encontrado.</p>
        </div>
    } @else {
        <div class="rounded-lg min-h-[38rem] flex flex-col">
            <div class="rounded-t-lg grid grid-cols-[10rem_1fr_7rem_6rem_6rem_12rem_36px] bg-primary text-base-100">
                <div (click)="ordenar('status')" class="cabecalho-listagem flex items-center">
                    <lucide-icon *ngIf="getSortIcon('status')" [name]="getSortIcon('status')" class="icone-ordenacao"/>
                    Status
                </div>
                <div (click)="ordenar('paciente')" class="cabecalho-listagem flex items-center">
                    <lucide-icon *ngIf="getSortIcon('paciente')" [name]="getSortIcon('paciente')" class="icone-ordenacao"/>
                    Paciente
                </div>
                <div (click)="ordenar('data')" class="cabecalho-listagem flex items-center">
                    <lucide-icon *ngIf="getSortIcon('data')" [name]="getSortIcon('data')" class="icone-ordenacao"/>
                    Data
                </div>
                <div (click)="ordenar('horaInicio')" class="cabecalho-listagem flex items-center">
                    <lucide-icon *ngIf="getSortIcon('horaInicio')" [name]="getSortIcon('horaInicio')" class="icone-ordenacao"/>
                    In√≠cio
                </div>
                <div (click)="ordenar('horaFim')" class="cabecalho-listagem flex items-center">
                    <lucide-icon *ngIf="getSortIcon('horaFim')" [name]="getSortIcon('horaFim')" class="icone-ordenacao"/>
                    Fim
                </div>
                <div (click)="ordenar('especialidade')" class="cabecalho-listagem flex items-center">
                    <lucide-icon *ngIf="getSortIcon('especialidade')" [name]="getSortIcon('especialidade')" class="icone-ordenacao"/>
                    Especialidade
                </div>
                <div class="p-0"></div>
            </div>

            <div class="bg-base-100 rounded-b-lg">
                @for (atendimento of getItensPaginados(); track atendimento.id) {
                    <div class="grid grid-cols-[10rem_1fr_7rem_6rem_6rem_12rem_36px] border-b hover:bg-base-200 cursor-pointer"
                         [class.bg-error]="atendimento.excluido"
                         [class.bg-opacity-50]="atendimento.excluido"
                         (click)="selecionar(atendimento); mostrarFormularioNovo = true;">
                        <div class="px-6 py-2 whitespace-nowrap flex items-center">
                            <div class="badge text-base-100" [ngClass]="'bg-['+CorAtendimento[atendimento.status]+']'">
                                {{ StatusAtendimentoDescricao[atendimento.status] }}
                            </div>
                        </div>
                        <div class="px-6 py-2 flex items-center truncate">{{atendimento.paciente.nome }}</div>
                        <div class="px-6 py-2 flex items-center">{{atendimento.data | date:'dd/MM/yyyy' }}</div>
                        <div class="px-6 py-2 flex items-center">{{atendimento.horaInicio }}</div>
                        <div class="px-6 py-2 flex items-center">{{atendimento.horaFim }}</div>
                        <div class="px-6 py-2 flex items-center truncate">{{atendimento.especialidade.nome }}</div>
                        <div class="p-0 text-right">
                            <div class="dropdown dropdown-end" (click)="$event.stopPropagation()">
                                <label tabindex="0" class="btn btn-ghost btn-sm m-1 p-1">
                                    <lucide-icon name="ellipsis-vertical" class="h-6" />
                                </label>
                                <ul tabindex="0"
                                    class="dropdown-content menu p-2 shadow-lg bg-base-100 rounded-lg w-40">
                                    <li *ngIf="!atendimento.excluido">
                                        <a (click)="editar($event, atendimento)"
                                           class="text-sm text-neutral hover:bg-base-200">
                                            Editar
                                        </a>
                                    </li>
                                    <li *ngIf="!atendimento.excluido">
                                        <a (click)="perguntaExcluir($event, atendimento)"
                                           class="text-error hover:bg-error/50">
                                            Excluir
                                        </a>
                                    </li>
                                    <li *ngIf="atendimento.excluido">
                                        <a (click)="restaurarItem($event, atendimento)"
                                           class="text-success hover:bg-success/20">
                                            Restaurar
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <app-pagination [items]="itensExibicao" [totalPaginas]="totalPaginas" (pageChange)="pageChange($event)"></app-pagination>
    }

  @if (mostrarFormularioNovo) {
    <app-atendimento-form
      [atendimento]="itemEdicao"
      [agendamentoId]="agendamentoId"
      (save)="onSalvarNovoAtendimento($event)"
      (cancel)="cancelarNovo()"
    ></app-atendimento-form>
  }

  <app-confirm-dialog
    *ngIf="exibeConfirmExclusao"
    message="Deseja realmente excluir este atendimento?"
    (confirm)="excluir()"
    (cancel)="fecharConfirmExclusao()"
  ></app-confirm-dialog>

  <app-fab (clicked)="novoAgendamento()"></app-fab>

</div>
