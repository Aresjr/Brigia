<div class="mt-4">

  <app-top-bar title="Agenda Diária" [showSearchBar]=false ></app-top-bar>

  <div class="bg-base-100 p-4 rounded-md">

    <div class="flex justify-between gap-4 mb-2 flex-wrap">
      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium text-gray-700">Visão</label>
        <div class="inline-flex rounded-lg border border-base-300 p-1">
          <button
            (click)="alternarModoVisualizacao('tudo')"
            class="btn btn-xs px-2 py-1 rounded-md transition-all duration-200"
            [class]="modoVisualizacao === 'tudo'
          ? 'btn-primary text-white font-medium'
          : 'btn-ghost text-gray-600 hover:bg-gray-50'">
            Tudo
          </button>
          <button
            (click)="alternarModoVisualizacao('agendamentos')"
            class="btn btn-xs px-2 py-1 rounded-md transition-all duration-200"
            [class]="modoVisualizacao === 'agendamentos'
          ? 'btn-primary text-white font-medium'
          : 'btn-ghost text-gray-600 hover:bg-gray-50'">
            Agendamentos
          </button>
          <button
            (click)="alternarModoVisualizacao('disponibilidades')"
            class="btn btn-xs px-2 py-1 rounded-md transition-all duration-200"
            [class]="modoVisualizacao === 'disponibilidades'
          ? 'btn-primary text-white font-medium'
          : 'btn-ghost text-gray-600 hover:bg-gray-50'">
            Agenda do Médico
          </button>
          <button
            (click)="alternarModoVisualizacao('filaEspera')"
            class="btn btn-xs px-2 py-1 rounded-md transition-all duration-200"
            [class]="modoVisualizacao === 'filaEspera'
          ? 'btn-primary text-white font-medium'
          : 'btn-ghost text-gray-600 hover:bg-gray-50'">
            Fila de Espera
          </button>
        </div>
      </div>

      <div *ngIf="!this.userService.isMedico()" class="flex flex-col gap-1">
        <label class="text-sm font-medium text-gray-700">Profissional</label>
        <ng-select class="w-72 hover:shadow-lg h-8 max-h-8 leading-none flex text-left"
                   (change)="selectProfissional($event)" placeholder="Todos os Profissionais">
          <ng-option class="max-h-8" value="0">Todos os Profissionais</ng-option>
          @for(profissional of this.profissionais; track profissional.id) {
            <ng-option class="max-h-8" value="{{ profissional.id }}">{{ profissional.nome }}</ng-option>
          }
          <ng-template ng-notfound-tmp>
            <span class="text-sm p-6">Nenhum resultado</span>
          </ng-template>
        </ng-select>
      </div>

      <div class="flex flex-col gap-1">
        <label class="text-sm font-medium text-gray-700">Paciente</label>
        <ng-select class="w-72 shadow-md hover:shadow-lg h-8 max-h-8 leading-none flex text-left"
                   (change)="selectPaciente($event)" placeholder="Todos os Pacientes">
          <ng-option class="max-h-8" value="0">Todos os Pacientes</ng-option>
          @for(paciente of this.pacientes; track paciente.id) {
            <ng-option class="max-h-8" value="{{ paciente.id }}">{{ paciente.nome }}</ng-option>
          }
          <ng-template ng-notfound-tmp>
            <span class="text-sm p-6">Nenhum resultado</span>
          </ng-template>
        </ng-select>
      </div>
    </div>

    @if (modoVisualizacao === 'filaEspera') {
      <app-fila-espera-lista
        [isLoading]="isLoading"
        [filaEspera]="filaEsperaLista"
        (recarrega)="carregarFilaEspera()"
        (criarAgendamento)="criarAgendamentoDeFilaEspera($event)"
        (remover)="removerFilaEspera($event)">
      </app-fila-espera-lista>
    } @else {
      <app-calendario
        class="z-10"
        [events]="eventosExibicao"
        [isLoading]="isLoading"
        (detalhesAgendamento)="detalhesAgendamento($event)"
        (detalhesDisponibilidade)="detalhesDisponibilidade($event)"
        (diaClicado)="diaClicado($event)"
        (horarioClicado)="horarioClicado($event)"
        (dataAlterada)="dataAlterada($event)"
        (recarrega)="carregarAgendamentos()">
      </app-calendario>
    }
  </div>

@if (exibeForm) {
  <app-agendamento-form
    [agendamentoDetalhes]="agendamentoDetalhes"
    [dataAgendamento]="dataAgendamento"
    [pacienteId]="pacienteId"
    [profissionalId]="profissionalFiltro !== 0 ? profissionalFiltro : null"
    [filaEspera]="filaEsperaSelecionada"
    (save)="salvar($event)"
    (cancel)="fecharForm()">
  </app-agendamento-form>
}

@if (exibeFormDisponibilidade) {
  <app-disponibilidade-form
    [disponibilidadeDetalhes]="disponibilidadeDetalhes"
    [profissionalId]="profissionalFiltro !== 0 ? profissionalFiltro : null"
    (saved)="exibeFormDisponibilidade = false; carregarAgendamentos();"
    (deleted)="exibeFormDisponibilidade = false; carregarAgendamentos();"
    (usarHorario)="abrirAgendamentoComDisponibilidade($event)"
    (cancel)="fecharFormDisponibilidade()">
  </app-disponibilidade-form>
}

  @if (exibeFormHonorarios) {
  <app-honorarios-form
    [profissionalId]="profissionalFiltro !== 0 ? profissionalFiltro : null"
    (cancel)="fecharFormHonorarios()">
  </app-honorarios-form>
}

@if (mostraFab()) {
  <app-fab [tituloBotao1]="'Criar Agendamento'" [iconeBotao1]="'calendar-plus'"
           (clickedBotao1)="addNovo()"
           [tituloBotao2]="'Criar Agenda do Médico'" [iconeBotao2]="'calendar-check'"
           (clickedBotao2)="addDisponibilidade()"
           [tituloBotao3]="'Gerar Honorários'" [iconeBotao3]="'dollar-sign'"
           (clickedBotao3)="gerarHonorarios()"
           class="fixed bottom-6 right-6 z-50"></app-fab>
}

<app-confirm-dialog
  *ngIf="exibeConfirmExclusaoFilaEspera"
  message="Deseja realmente excluir este paciente da fila de espera?"
  (confirm)="confirmarExclusaoFilaEspera()"
  (cancel)="cancelarExclusaoFilaEspera()"
></app-confirm-dialog>

</div>
